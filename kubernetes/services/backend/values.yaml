backend:
  deployment:
    replicaCount: 2
    image:
      repository: us-central1-docker.pkg.dev/staging-60514/stage-images/backend
      tag: sha-3adba4180823c4bb13aab09e28bc06bd57f69c2b
      pullPolicy: IfNotPresent
    containerPort: 3000

    env:
      NODE_ENV: production
    resources:
      requests:
        cpu: '100m'
        memory: '128Mi'
      limits:
        cpu: '500m'
        memory: '512Mi'

  service:
    type: ClusterIP
    port: 80
    targetPort: 3000

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

    # Scale down behavior (conservative to avoid flapping)
    scaleDown:
      stabilizationWindowSeconds: 300 # Wait 5 minutes before scaling down
      percentValue: 50 # Max 50% of pods can be removed
      podsValue: 2 # Or max 2 pods can be removed
      periodSeconds: 60

    # Scale up behavior (aggressive for quick response)
    scaleUp:
      stabilizationWindowSeconds: 0 # Scale up immediately
      percentValue: 100 # Can double pods
      podsValue: 4 # Or add up to 4 pods
      periodSeconds: 60
